<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buckshot Counter</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
    body { 
        margin: 0; padding: 0; min-height: 100vh; color: #d1d1d1; 
        font-family: 'Courier Prime', 'Courier New', monospace; 
        text-align: center; background: url('buckshot.png');
        background-size: cover; background-position: center; background-attachment: fixed; 
        background-color: #000; display: flex; flex-direction: column; align-items: center;
    }

    .main-ui { width: 100%; max-width: 800px; padding-top: 40px; z-index: 5; }

    h1 { 
        font-family: 'Bebas Neue', sans-serif; color: #8b0000; font-size: 4.5rem; 
        letter-spacing: 10px; text-shadow: 4px 4px 6px #000; margin: 0 0 20px 0;
        text-transform: uppercase; white-space: nowrap; 
    }

    .shell-container { display: flex; justify-content: center; gap: 10px; margin: 25px auto; flex-wrap: wrap; }
    
    .shell {
        width: 42px; height: 65px; border: 2px solid #555; border-radius: 4px;
        background: rgba(0, 0, 0, 0.4); cursor: pointer; display: flex; align-items: center;
        justify-content: center; font-weight: bold; font-size: 20px; transition: 0.2s;
        position: relative; color: #fff; font-family: 'Bebas Neue', sans-serif;
        text-shadow: 1px 1px 3px #000;
    }
     
    .shell.current { 
        border-color: #d4af37; 
        color: #fff; 
        transform: scale(1.15); 
        z-index: 10;
        animation: real-breathing 3s ease-in-out infinite;
        outline: 1px solid rgba(212, 175, 55, 0.3); 
    }

    .shell.current::after { 
        content: '▲'; position: absolute; bottom: -22px; color: #d4af37; font-size: 12px; 
        animation: arrow-bounce 1.5s infinite ease-in-out;
    }

    @keyframes arrow-bounce {
        0%, 100% { transform: translateY(0); opacity: 0.5; }
        50% { transform: translateY(-5px); opacity: 1; }
    }

    .shell.live { 
        background: #8b0000; border-color: #ff0000; color: #fff; 
        box-shadow: inset 0 0 12px rgba(255, 0, 0, 0.4);
    }
    .shell.blank { 
        background: #001f3f; border-color: #0074d9; color: #fff; 
        box-shadow: inset 0 0 12px rgba(0, 116, 217, 0.4);
    }

    @keyframes real-breathing {
        0%, 100% {
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.3);
            border-color: rgba(212, 175, 55, 0.5);
        }
        50% {
            box-shadow: 
                0 0 15px rgba(212, 175, 55, 0.8), 
                0 0 30px rgba(212, 175, 55, 0.4), 
                inset 0 0 15px rgba(255, 215, 0, 0.5); 
            border-color: rgba(255, 215, 0, 1);
        }
    }

    .track-controls { 
        margin: 20px 0; display: flex; justify-content: center; gap: 15px; 
        align-items: center; background: transparent; padding: 10px 20px; 
        text-shadow: 2px 2px 2px #000, -1px -1px 1px #000, 1px -1px 1px #000, -1px 1px 1px #000;
    }
    .nav-btn { background: rgba(0,0,0,0.5); color: #d4af37; border: 1px solid #d4af37; padding: 5px 15px; cursor: pointer; font-family: 'Bebas Neue', sans-serif; }

    .counter-box { display: flex; justify-content: center; gap: 40px; margin-top: 20px; background: transparent; }
    .counter-box p { text-shadow: 2px 2px 2px #000, -1px -1px 0px #000, 1px -1px 0px #000, -1px 1px 0px #000; }

    #live-count, #blank-count { font-family: 'Bebas Neue', sans-serif; font-size: 45px; margin: 0 15px; color: #fff; vertical-align: middle; text-shadow: 2px 2px 4px #000; }

    .btn { width: 50px; height: 50px; font-size: 24px; cursor: pointer; border: none; border-radius: 4px; font-family: 'Bebas Neue', sans-serif; box-shadow: 2px 2px 5px #000; }
    .live-btn { background: #8b0000; color: #fff; }
    .blank-btn { background: #001f3f; color: #fff; }

    .result { margin-top: 30px; background: transparent; padding: 15px; font-family: 'Bebas Neue', sans-serif; text-shadow: 2px 2px 2px #000, -1px -1px 1px #000; }
    
    .highlight { 
        font-weight: bold; color: #d4af37; font-size: 2.5rem; 
        text-shadow: 0 0 8px #000; 
        animation: text-breathing 3s ease-in-out infinite;
    }

    @keyframes text-breathing {
        0%, 100% { text-shadow: 0 0 8px rgba(0, 0, 0, 0.8), 0 0 5px rgba(212, 175, 55, 0.2); }
        50% { 
            text-shadow: 0 0 10px rgba(0, 0, 0, 1), 0 0 20px rgba(212, 175, 55, 1), 0 0 35px rgba(212, 175, 55, 0.6);
            color: #fff2a8;
        }
    }
    .reset-btn { background: rgba(0,0,0,0.3); border: 1px solid #444; color: #fff; margin: 30px 0; padding: 8px 16px; cursor: pointer; font-family: 'Bebas Neue', sans-serif; text-shadow: 1px 1px 2px #000; }
</style>
</head>
<body>

    <div class="main-ui">
        <h1>Buckshot Counter</h1>
        <div class="shell-container" id="shell-track"></div>
        <div class="track-controls">
            <button class="nav-btn" onclick="movePointer(-1)">←</button>
            <div>當前發數 <span id="curr-num" class="highlight" style="font-size: 1.5rem;">1</span></div>
            <button class="nav-btn" onclick="movePointer(1)">→</button>
        </div>
        <div class="counter-box">
            <div>
                <p style="color: #ff4444; margin: 5px; font-weight: bold;">實彈 (Q-A)</p>
                <button class="btn live-btn" onclick="update('live', 1)">+</button>
                <span id="live-count">0</span>
                <button class="btn live-btn" onclick="update('live', -1)">-</button>
            </div>
            <div>
                <p style="color: #44aaff; margin: 5px; font-weight: bold;">空彈 (E-D)</p>
                <button class="btn blank-btn" onclick="update('blank', 1)">+</button>
                <span id="blank-count">0</span>
                <button class="btn blank-btn" onclick="update('blank', -1)">-</button>
            </div>
        </div>
        <div class="result">
            <p>實彈機率: <span id="live-prob" class="highlight">--</span> %</p>
            <p>空彈機率: <span id="blank-prob" class="highlight">--</span> %</p>
        </div>
        <button class="reset-btn" onclick="reset()">RESET (R)</button>
    </div>

    <script>
        let live = 0, blank = 0, currentIndex = 0;
        
        function createShells() {
            const track = document.getElementById('shell-track');
            track.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const s = document.createElement('div');
                s.className = 'shell';
                if (i === currentIndex) s.classList.add('current');
                s.innerText = i + 1;
                
                s.onclick = function() {
                    if (this.classList.contains('live')) { 
                        this.classList.remove('live'); this.classList.add('blank'); 
                    }
                    else if (this.classList.contains('blank')) { 
                        this.classList.remove('blank'); 
                    }
                    else { 
                        this.classList.add('live'); 
                    }
                };
                track.appendChild(s);
            }
        }

        function movePointer(dir) {
            currentIndex = (currentIndex + dir + 8) % 8;
            document.getElementById('curr-num').innerText = currentIndex + 1;
            const shells = document.querySelectorAll('.shell');
            shells.forEach((s, i) => s.classList.toggle('current', i === currentIndex));
        }

        // 核心邏輯修正：確保 live + blank 總數不超過 8
        function update(type, change) {
            let total = live + blank;
            
            if (type === 'live') {
                if (change > 0) {
                    if (total < 8) live++; 
                } else {
                    live = Math.max(0, live - 1);
                }
            }
            
            if (type === 'blank') {
                if (change > 0) {
                    if (total < 8) blank++;
                } else {
                    blank = Math.max(0, blank - 1);
                }
            }

            document.getElementById('live-count').innerText = live;
            document.getElementById('blank-count').innerText = blank;
            calculate();
        }

        function calculate() {
            let total = live + blank;
            document.getElementById('live-prob').innerText = total === 0 ? "--" : Math.round((live/total)*100);
            document.getElementById('blank-prob').innerText = total === 0 ? "--" : Math.round((blank/total)*100);
        }

        function reset() {
            live = 0; blank = 0; currentIndex = 0;
            document.getElementById('live-count').innerText = 0;
            document.getElementById('blank-count').innerText = 0;
            document.getElementById('curr-num').innerText = 1;
            createShells(); calculate();
        }

        document.addEventListener('keydown', (e) => {
            const key = e.key.toUpperCase();
            if (key === 'Q') update('live', 1); if (key === 'A') update('live', -1);
            if (key === 'E') update('blank', 1); if (key === 'D') update('blank', -1);
            if (key === 'R') reset(); if (key === 'ARROWLEFT') movePointer(-1);
            if (key === 'ARROWRIGHT' || key === ' ') { e.preventDefault(); movePointer(1); }
        });

        createShells();
    </script>
</body>

</html>
